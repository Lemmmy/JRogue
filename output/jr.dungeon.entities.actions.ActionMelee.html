<HTML>
<HEAD>
<TITLE>JDocCoverage Report - 14-Mar-2017 09:54:02</TITLE>
<link rel='stylesheet' type='text/css' href='default.css'>
</HEAD>
<BODY>
<TABLE cellspacing='0' class='header'><TR><TD class='title'>JDocCoverage Report - 14-Mar-2017 09:54:02</TD></TR>
<TR><TD class='menu'><a class='menu' href='index.html'>Overview</a> | <a class='menu' href='jr.dungeon.entities.actions.html'>jr.dungeon.entities.actions</a></TD></TR></TABLE>
<p>
<TABLE cellspacing='0'>
<TR><TH>Name</TH><TH>method, %</TH><TH>comment, %</TH><TH>TODO</TH><TH>@see</TH></TR>

<TR><TD>jr.dungeon.entities.actions.ActionMelee</TD><TD>2</TD><TD>14.1% &nbsp; (257/1572)</TD><TD>0</TD><TD>1</TD></TR>
</TABLE>
<CODE><PRE>
<span class='code'>package jr.dungeon.entities.actions;

import jr.dungeon.Messenger;
import jr.dungeon.entities.*;
import jr.dungeon.entities.events.EntityAttackMissedEvent;
import jr.dungeon.entities.player.Player;

</span><span class='comment'>/**
 * Melee attack action.
 *
 * @see Action
 */</span><span class='code'>
public class ActionMelee extends Action {
	private final EntityLiving victim;
	private final DamageSource damageSource;
	private final int damage;
	
</span><span class='comment'>	/**
	 * Melee attack action.
	 *
	 * @param victim The entity that was attacked.
	 * @param damageSource The source of the damage. See {@link DamageSource}.
	 * @param damage The amount of damage to deal.
	 * @param callback Callback to call when action-related events occur. See
	 * {@link Action.ActionCallback}.
	 */</span><span class='code'>
	public ActionMelee(EntityLiving victim, DamageSource damageSource, int damage, ActionCallback callback) {
		super(callback);
		this.victim = victim;
		this.damageSource = damageSource;
		this.damage = damage;
	}
	
	@Override
	public void execute(Entity entity, Messenger msg) {
		if (!(entity instanceof EntityLiving)) {
			return;
		}
		
		EntityLiving attacker = (EntityLiving) entity;
		boolean isAttackerPlayer = attacker instanceof Player;
		boolean isVictimPlayer = victim instanceof Player;
		
		Hit hit = new Hit(HitType.SUCCESS, damage);
		
		if (isAttackerPlayer && !isVictimPlayer) {
			hit = ((Player) attacker).hitAgainstMonster(damageSource, damage, victim);
		} else if (!isAttackerPlayer && isVictimPlayer) {
			hit = ((Player) victim).hitFromMonster(damageSource, damage, attacker);
		}
		
		switch (hit.getHitType()) {
			case JUST_MISS:
				victim.getDungeon().triggerEvent(new EntityAttackMissedEvent(victim, attacker, damageSource, hit));
				
				if (isAttackerPlayer) {
					msg.orangeYou("just miss the %s.", victim.getName((EntityLiving) entity, false));
				} else if (isVictimPlayer) {
					msg.The("%s just misses.", attacker.getName((EntityLiving) entity, false));
				}
				break;
			case MISS:
				victim.getDungeon().triggerEvent(new EntityAttackMissedEvent(victim, attacker, damageSource, hit));
				
				if (isAttackerPlayer) {
					msg.orangeYou("miss the %s.", victim.getName((EntityLiving) entity, false));
				} else if (isVictimPlayer) {
					msg.The("%s misses.", attacker.getName((EntityLiving) entity, false));
				}
				break;
			case SUCCESS:
				runBeforeRunCallback(entity);
				victim.damage(damageSource, damage, attacker);
				runOnCompleteCallback(entity);
				break;
			default:
				break;
		}
	}
}
</span>
</PRE></CODE>
</BODY>
</HTML>
