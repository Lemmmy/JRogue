<HTML>
<HEAD>
<TITLE>JDocCoverage Report - 14-Mar-2017 09:54:02</TITLE>
<link rel='stylesheet' type='text/css' href='default.css'>
</HEAD>
<BODY>
<TABLE cellspacing='0' class='header'><TR><TD class='title'>JDocCoverage Report - 14-Mar-2017 09:54:02</TD></TR>
<TR><TD class='menu'><a class='menu' href='index.html'>Overview</a> | <a class='menu' href='jr.dungeon.wishes.html'>jr.dungeon.wishes</a></TD></TR></TABLE>
<p>
<TABLE cellspacing='0'>
<TR><TH>Name</TH><TH>method, %</TH><TH>comment, %</TH><TH>TODO</TH><TH>@see</TH></TR>

<TR><TD>jr.dungeon.wishes.Wishes</TD><TD>5</TD><TD>1.7% &nbsp; (100/5829)</TD><TD>0</TD><TD>0</TD></TR>
</TABLE>
<CODE><PRE>
<span class='code'>package jr.dungeon.wishes;

import jr.dungeon.Dungeon;
import jr.dungeon.entities.DamageSource;
import jr.dungeon.entities.EntityLiving;
import jr.dungeon.entities.containers.EntityChest;
import jr.dungeon.entities.containers.EntityWeaponRack;
import jr.dungeon.entities.decoration.EntityCandlestick;
import jr.dungeon.entities.decoration.EntityFountain;
import jr.dungeon.entities.effects.*;
import jr.dungeon.entities.magic.EntityAltar;
import jr.dungeon.entities.monsters.canines.*;
import jr.dungeon.entities.monsters.critters.MonsterLizard;
import jr.dungeon.entities.monsters.critters.MonsterRat;
import jr.dungeon.entities.monsters.critters.MonsterSpider;
import jr.dungeon.entities.monsters.humanoids.MonsterSkeleton;
import jr.dungeon.entities.player.Player;
import jr.dungeon.items.Item;
import jr.dungeon.items.ItemStack;
import jr.dungeon.items.Material;
import jr.dungeon.items.comestibles.*;
import jr.dungeon.items.magical.ItemSpellbook;
import jr.dungeon.items.magical.spells.SpellLightOrb;
import jr.dungeon.items.projectiles.ItemArrow;
import jr.dungeon.items.quaffable.potions.BottleType;
import jr.dungeon.items.quaffable.potions.ItemPotion;
import jr.dungeon.items.quaffable.potions.PotionType;
import jr.dungeon.items.valuables.ItemThermometer;
import jr.dungeon.items.weapons.*;
import jr.dungeon.tiles.TileType;
import jr.utils.RandomUtils;
import org.apache.commons.lang3.tuple.Pair;

import java.util.Arrays;
import java.util.HashSet;
import java.util.Optional;
import java.util.Set;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class Wishes {
	private static final String wishSword =
		"(wood|stone|bronze|iron|steel|silver|gold|mithril|adamantite) (shortsword|longsword|dagger)";

	private final Set&lt;Pair&lt;Pattern, Wish>> wishes = new HashSet&lt;>();

	private static Wishes instance;

	public static Wishes get() {
		if (instance == null) {
			instance = new Wishes();
		}

		return instance;
	}

	private Wishes() {
</span><span class='comment'>		// Basic wishes
</span><span class='code'>		registerWish("death", (d, p, a) -> p.kill(DamageSource.WISH_FOR_DEATH, 0, null));
		registerWish("kill\\s+all", (d, p, a) ->
			d.getLevel().getEntityStore().getEntities().stream()
				.filter(e -> e instanceof EntityLiving && !(e instanceof Player))
				.map(e -> (EntityLiving) e)
				.forEach(e -> e.kill(DamageSource.WISH_FOR_DEATH, 0, null)));
		registerWish("nutrition", (d, p, a) -> p.setNutrition(1000));
		registerWish("health", (d, p, a) -> p.setHealth(p.getMaxHealth()));
		registerWish("(?:ds|downstairs)", (d, p, a) ->
			Arrays.stream(p.getLevel().getTileStore().getTiles())
				.filter(t -> t.getType() == TileType.TILE_ROOM_STAIRS_DOWN)
				.findFirst()
				.ifPresent(t -> {
					p.defaultVisitors.teleport(t.getX(), t.getY());
					p.defaultVisitors.climbDown();
				}));
		registerWish("godmode", (d, p, a) -> p.setGodmode(true));
		registerWish("chest", new WishSpawn&lt;>(EntityChest.class));
		registerWish("fountain", new WishSpawn&lt;>(EntityFountain.class));
		registerWish("candlestick", new WishSpawn&lt;>(EntityCandlestick.class));
		registerWish("weapon rack", new WishSpawn&lt;>(EntityWeaponRack.class));
		registerWish("altar", new WishSpawn&lt;>(EntityAltar.class));

</span><span class='comment'>		// Tiles
</span><span class='code'>		registerWish("rug", new WishTile(TileType.TILE_ROOM_RUG));
		registerWish("dirt", new WishTile(TileType.TILE_ROOM_DIRT));
		registerWish("water", new WishTile(TileType.TILE_ROOM_WATER));
		registerWish("ice", new WishTile(TileType.TILE_ROOM_ICE));


</span><span class='comment'>		// Status effects
</span><span class='code'></span><span class='comment'>		// NOTE: Please add a new wish here for any status effects you implement.
</span><span class='code'>		registerWish("paralysis", new WishEffect(Paralysis.class));
		registerWish("food poisoning", new WishEffect(FoodPoisoning.class));
		registerWish("injured foot", new WishEffect(InjuredFoot.class));
		registerWish("mercury poisoning", new WishEffect(MercuryPoisoning.class));
		registerWish("strained leg", new WishEffect(StrainedLeg.class));
		registerWish("fire", new WishEffect(Ablaze.class));

</span><span class='comment'>		// Monsters
</span><span class='code'>		registerWish("jackal", new WishSpawn&lt;>(MonsterJackal.class));
		registerWish("fox", new WishSpawn&lt;>(MonsterFox.class));
		registerWish("lizard", new WishSpawn&lt;>(MonsterLizard.class));
		registerWish("hound", new WishSpawn&lt;>(MonsterHound.class));
		registerWish("hellhound", new WishSpawn&lt;>(MonsterHellhound.class));
		registerWish("icehound", new WishSpawn&lt;>(MonsterIcehound.class));
		registerWish("spider", new WishSpawn&lt;>(MonsterSpider.class));
		registerWish("rat", new WishSpawn&lt;>(MonsterRat.class));
		registerWish("skeleton", new WishSpawn&lt;>(MonsterSkeleton.class));

</span><span class='comment'>		// Items
</span><span class='code'>		registerWish(wishSword, (d, p, a) -> {
			if (a.length &lt; 2) return;

			Material m = Material.valueOf(a[0].toUpperCase());
			String type = a[1];

			Item item = null;

			switch (type.toLowerCase()) {
				case "shortsword": item = new ItemShortsword(m); break;
				case "longsword": item = new ItemLongsword(m); break;
				case "dagger": item = new ItemDagger(m); break;
				default: break;
			}

			if (item != null && p.getContainer().isPresent()) {
				p.getContainer().get().add(new ItemStack(item));
				d.turn();
			}
		});

		registerWish("potion", new WishItem&lt;>(ItemPotion.class, p -> {
			BottleType bottle = RandomUtils.randomFrom(BottleType.values());
			PotionType potionType = RandomUtils.randomFrom(PotionType.values());
			float potency = RandomUtils.randomFloat(6f);

			p.setBottleType(bottle);
			p.setPotionType(potionType);
			p.setEmpty(false);
			p.setPotency(potency);
		}));

		registerWish("bread", new WishItem&lt;>(ItemBread.class));
		registerWish("apple", new WishItem&lt;>(ItemApple.class));
		registerWish("orange", new WishItem&lt;>(ItemOrange.class));
		registerWish("lemon", new WishItem&lt;>(ItemLemon.class));
		registerWish("banana", new WishItem&lt;>(ItemBanana.class));
		registerWish("carrot", new WishItem&lt;>(ItemCarrot.class));
		registerWish("cherries", new WishItem&lt;>(ItemCherries.class));
		registerWish("corn", new WishItem&lt;>(ItemCorn.class));
		registerWish("staff", new WishItem&lt;>(ItemStaff.class));
		registerWish("spellbook", new WishItem&lt;>(ItemSpellbook.class, s -> s.setSpell(new SpellLightOrb())));
		registerWish("bow", new WishItem&lt;>(ItemBow.class));
		registerWish("arrow", new WishItem&lt;>(ItemArrow.class));
		registerWish("thermometer", new WishItem&lt;>(ItemThermometer.class));
	}

	public void registerWish(Pattern pattern, Wish wish) {
		wishes.add(Pair.of(pattern, wish));
	}

	public void registerWish(String pattern, Wish wish) {
		registerWish(Pattern.compile("^" + pattern + "$"), wish);
	}

	public boolean makeWish(Dungeon dungeon, String _wish) {
		final String wish = _wish.toLowerCase();
		final Player player = dungeon.getPlayer();

		if (player == null || !player.isDebugger()) {
			dungeon.redYou("can't do that.");
			return false;
		}

		Optional&lt;Pair&lt;Matcher, Wish>> optP = wishes.stream()
			.map(p -> Pair.of(p.getKey().matcher(wish), p.getValue()))
			.filter(p -> p.getKey().matches())
			.findFirst();

		if (optP.isPresent()) {
			Pair&lt;Matcher, Wish> p = optP.get();
			Matcher m = p.getKey();
			Wish w = p.getValue();

			int gc = m.groupCount();
			String[] args = new String[gc];

			for (int i = 1; i &lt; gc + 1; ++i) {
				args[i - 1] = m.group(i);
			}

			w.grant(dungeon, player, args);

			return true;
		} else {
			dungeon.logRandom(
				"[RED]You have extraordinary needs.",
				"[RED]You speak in mysteries.",
				"[RED]You speak in riddles.",
				"[RED]You are undecipherable."
			);

			return false;
		}
	}
}
</span>
</PRE></CODE>
</BODY>
</HTML>
